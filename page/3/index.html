<!-- build time:Tue Feb 11 2020 02:20:30 GMT+0800 (China Standard Time) --><!DOCTYPE html><html class="theme-next pisces use-motion" lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=6.0.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.4"><link rel="mask-icon" href="/images/logo.svg?v=6.0.4" color="#222"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"6.0.4",sidebar:{position:"right",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!1,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="keywords" content="Hexo, NexT"><meta property="og:type" content="website"><meta property="og:title" content="Whyn"><meta property="og:url" content="https://why8n.top/page/3/index.html"><meta property="og:site_name" content="Whyn"><meta property="og:locale" content="zh_CN"><meta property="article:author" content="Whyn"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://why8n.top/page/3/"><script type="text/javascript" id="page.configurations">CONFIG.page={sidebar:""}</script><title>Whyn</title><noscript><style type="text/css">.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-right page-home"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Whyn</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><section id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://why8n.top/post/2020/02/09/mybatis/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Whyn"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.gif"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Whyn"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a class="post-title-link" href="/post/2020/02/09/mybatis/" itemprop="url">mybatis</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-09T21:08:26+08:00">2020-02-09</time></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><blockquote><p><a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 是一款优秀的持久层框架，它支持定制化 SQL、存储过程以及高级映射。<a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集。<a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 可以使用简单的 XML 或注解来配置和映射原生类型、接口和 Java 的 POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。</p></blockquote><h2 id="入门案例"><a href="#入门案例" class="headerlink" title="入门案例"></a><a href="http://www.mybatis.org/mybatis-3/getting-started.html" target="_blank" rel="noopener">入门案例</a></h2><p>下面列举一个简单例子，来阐述 <a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 的常用操作。</p><p>例子：假设数据库<code>school</code>内部有一张表<code>students</code>，我们希望能使用 <a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 来实现对<code>student</code>表的增删改查操作。</p><p>具体步骤如下：</p><ul><li>首先，我们先创建数据库<code>school</code>和表<code>students</code>，并插入一些预备数据：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 创建数据库 school</span><br><span class="line">create database if not exists school;</span><br><span class="line"># 使用数据库 school</span><br><span class="line">use school;</span><br><span class="line"># 创建表 student</span><br><span class="line">create table if not exists students (</span><br><span class="line">    -&gt; id int primary key auto_increment,</span><br><span class="line">    -&gt; name varchar(20) not null,</span><br><span class="line">    -&gt; sex varchar(6) default &quot;male&quot;,</span><br><span class="line">    -&gt; cls int not null);</span><br><span class="line"># 插入一些数据</span><br><span class="line">insert into students(id,name,sex,cls) values(1,&quot;小明&quot;,&quot;male&quot;,1);</span><br><span class="line">insert into students values(2,&quot;小红&quot;,&quot;female&quot;,2);</span><br><span class="line">insert into students(name,sex,cls) values(&quot;小芳&quot;,&quot;female&quot;,2);</span><br><span class="line">insert into students(name,cls) values(&quot;小宁&quot;,4);</span><br></pre></td></tr></table></figure>经过上面操作后，<code>students</code>表就存储了如下内容：</li></ul><p><img src="https://upload-images.jianshu.io/upload_images/2222997-78cacdbc5d5c5b93.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="students"></p><ul><li>创建一个使用 <a href="http://maven.apache.org/" target="_blank" rel="noopener">Maven</a> 作为依赖管理的普通 Java 工程，如下图所示：</li></ul><p><img src="https://upload-images.jianshu.io/upload_images/2222997-5b72b6192097a20b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><ul><li>在 pom.xml 中添加依赖：必须添加的是 <a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 依赖和 <a href="https://mvnrepository.com/artifact/mysql/mysql-connector-java/8.0.16" target="_blank" rel="noopener">mysql-connector</a> 驱动依赖，同时这里我们也添加一个 <a href="https://mvnrepository.com/artifact/log4j/log4j/1.2.17" target="_blank" rel="noopener">log4j</a> 依赖，用以配置日志输出：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.mybatis&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mybatis&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;3.5.1&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;8.0.16&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;log4j&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;log4j&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.2.17&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;&#x2F;dependencies&gt;</span><br></pre></td></tr></table></figure>然后在主工程<code>resources</code>资源目录下，创建一个配置文件：<code>log4j.properties</code>，进行日志信息配置：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Global logging configuration</span><br><span class="line">log4j.rootLogger&#x3D;DEBUG, stdout</span><br><span class="line"># Console output...</span><br><span class="line">log4j.appender.stdout&#x3D;org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.stdout.layout&#x3D;org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.stdout.layout.ConversionPattern&#x3D;%5p [%t] - %m%n</span><br></pre></td></tr></table></figure></li><li>接下来，继续在主工程<code>resources</code>目录下创建一个全局的 <a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 配置文件，该文件可任意命名，我们这里将其命名为：<code>MyBatisConfig.xml</code>，具体内容如下：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"https://www.mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置环境：和spring整合后 environments配置将废除--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置mysql环境 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 配置事务：使用jdbc事务管理--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 数据库连接池--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.cj.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/school?serverTimezone=GMT"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--注意：这里必须是username,一定要规范--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"password"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>可以看到，上述全局配置表主要完成的是对开发环境和 MySql 连接信息的配置。</li><li>要想使用 <a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 完成对具体某一张表的操作，我们还需要为这张表的相关操作创建相应接口和配置文件，并在全局配置表中将相关配置文件具体内容进行注入。具体操作如下：</li></ul><p>1）创建表对应的 POJO 类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yn.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Whyn</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 7/16/2019 5:37 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> cls;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 必须创建一个默认构造函数，否则就需要构造一个映射器，比如</span></span><br><span class="line"><span class="comment"> *     &lt;resultMap id="studentResultMap" type="com.yn.bean.Student"&gt;</span></span><br><span class="line"><span class="comment"> *        &lt;constructor&gt;</span></span><br><span class="line"><span class="comment"> *            &lt;arg column="name" javaType="String" /&gt;</span></span><br><span class="line"><span class="comment"> *             &lt;arg column="sex" javaType="String" /&gt;</span></span><br><span class="line"><span class="comment"> *             &lt;arg column="cls" javaType="_int" /&gt;</span></span><br><span class="line"><span class="comment"> *         &lt;/constructor&gt;</span></span><br><span class="line"><span class="comment"> *     &lt;/resultMap&gt;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name, String sex, <span class="keyword">int</span> cls)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.sex = sex;</span><br><span class="line">        <span class="keyword">this</span>.cls = cls;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSex</span><span class="params">(String sex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCls</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cls;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCls</span><span class="params">(<span class="keyword">int</span> cls)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cls = cls;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Student&#123;"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", sex='"</span> + sex + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", cls="</span> + cls +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2）创建对表操作的相应接口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yn.interfaces;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yn.bean.Student;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IStudentsDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">//    增：添加学生</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(Student student)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    删：删除学生</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">(String name)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    改：更改信息</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(String name)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    查：查询所有</span></span><br><span class="line">    <span class="function">List&lt;Student&gt; <span class="title">selectAll</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3）在主工程资源目录<code>resources</code>下，创建对表操作的配置信息（对于每一个 Dao，都创建对应包名目录的配置文件，比如：<code>com.yn.interfaces.IStudentsDao</code>，则创建对应配置文件：<code>com/yn/interfaces/IStudentsDao.xml</code>）：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.yn.interfaces.IStudentsDao"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"add"</span> <span class="attr">parameterType</span>=<span class="string">"com.yn.bean.Student"</span>&gt;</span></span><br><span class="line">        insert into students(name,sex,cls) values(#&#123;name&#125;,#&#123;sex&#125;,#&#123;cls&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"delete"</span> <span class="attr">parameterType</span>=<span class="string">"String"</span>&gt;</span></span><br><span class="line">        delete from students where name=#&#123;name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"update"</span> <span class="attr">parameterType</span>=<span class="string">"com.yn.bean.Student"</span>&gt;</span></span><br><span class="line">        update students set sex=#&#123;sex&#125;,cls=#&#123;cls&#125; where name=#&#123;name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectAll"</span> <span class="attr">resultType</span>=<span class="string">"com.yn.bean.Student"</span>&gt;</span></span><br><span class="line">        select * from students</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>注</strong>：<code>&lt;mapper&gt;</code>标签中的<code>namespace</code>表示表对应接口类，各个数据库操作的属性<code>id</code>表示接口类对应的方法名。因此，由<code>namespace + id</code>就可以唯一确定对应的操作方法。</p><p>4）创建完对表的操作配置文件后，还需在全局配置文件中注入该配置文件，因此，全局配置表完整内容如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"https://www.mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 和spring整合后 environments配置将废除--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 使用jdbc事务管理--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 数据库连接池--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.cj.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/school?serverTimezone=GMT"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--注意：这里必须是username,一定要规范--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"password"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 注入各个具体配置表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指明具体配置表路径 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"com/yn/interfaces/IStudentsDao.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>5）最后，就可以通过代码对数据库表进行操作，代码如下所示：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"><span class="comment">//        加载全局配置文件</span></span><br><span class="line">        InputStream config = Resources.getResourceAsStream(<span class="string">"MyBatisConfig.xml"</span>);</span><br><span class="line"><span class="comment">//        创建工厂类</span></span><br><span class="line">        SqlSessionFactory factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(config);</span><br><span class="line"><span class="comment">//        由工厂创建得到操作数据库表的 SqlSession 对象</span></span><br><span class="line">        SqlSession session = factory.openSession();</span><br><span class="line"><span class="comment">//        得到表操作代理对象</span></span><br><span class="line">        IStudentsDao studentsDaoProxy = session.getMapper(IStudentsDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"><span class="comment">//        增：添加学生</span></span><br><span class="line">        Student student = <span class="keyword">new</span> Student(<span class="string">"Whyn"</span>, <span class="string">"male"</span>, <span class="number">7</span>);</span><br><span class="line">        studentsDaoProxy.add(student);</span><br><span class="line">        session.commit();</span><br><span class="line"></span><br><span class="line"><span class="comment">//        删：删除学生</span></span><br><span class="line">        studentsDaoProxy.delete(<span class="string">"Whyn"</span>);</span><br><span class="line">        session.commit();</span><br><span class="line"></span><br><span class="line"><span class="comment">//        改：更改信息</span></span><br><span class="line">        student = <span class="keyword">new</span> Student(<span class="string">"小明"</span>, <span class="string">"male"</span>, <span class="number">8</span>);</span><br><span class="line">        studentsDaoProxy.update(student);</span><br><span class="line">        session.commit();</span><br><span class="line"><span class="comment">//        查：查询所有</span></span><br><span class="line">        List&lt;Student&gt; students = studentsDaoProxy.selectAll();</span><br><span class="line"><span class="comment">//        释放资源</span></span><br><span class="line">        session.close();</span><br><span class="line">        config.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>注</strong>：此处我们使用的是 <a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 推荐的基于动态代理生成<code>IUserDao</code>代理实例进行数据库操作，当然也可以自己通过实现具体的<code>IStudentsDao</code>实例对数据库进行操作，其原理就是在具体实现类内部创建<code>SqlSession</code>实例进而操作数据库，具体做法此处就不进行展开了。</p><p>以上，就是使用 <a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 对数据库进行操作的基本操作过程了。</p><h2 id="全局配置文件"><a href="#全局配置文件" class="headerlink" title="全局配置文件"></a><a href="http://www.mybatis.org/mybatis-3/configuration.html" target="_blank" rel="noopener">全局配置文件</a></h2><p>下面对 <a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 的全局配置文件（即：<code>MyBatisConfig.xml</code>）中的常用配置选项进行讲解：</p><p><strong>注</strong>：以下所讲解的属性配置均位于大标签<code>&lt;configuration&gt;</code>内部。</p><ul><li><p><strong><a href="http://www.mybatis.org/mybatis-3/configuration.html#properties" target="_blank" rel="noopener">properties</a></strong>：这些属性都是外部配置且可动态替换的，既可以在典型的 Java 属性文件中配置，亦可通过<code>properties</code>元素的子元素来传递。例如：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.cj.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/school?serverTimezone=GMT"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"password"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后其中的属性就可以在整个配置文件中被用来替换需要动态配置的属性值。比如:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;driver&#125;"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;url&#125;"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;username&#125;"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;password&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure><p>但是，<code>properties</code>更常用的方式是读取外部配置文件，通过属性<code>resource</code>/<code>url</code>指定外部配置文件即可，具体操作如下：<br>1）在<code>resources</code>目录下，创建一个配置文件：<strong>db.properties</strong>，内容如下：</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jdbc.driver=com.mysql.cj.jdbc.Driver</span><br><span class="line">jdbc.url=jdbc:mysql://localhost:<span class="number">3306</span>/school?serverTimezone=GMT</span><br><span class="line">jdbc.username=root</span><br><span class="line">jdbc.password=password</span><br></pre></td></tr></table></figure><p>2）然后在全局配置文件（<code>MyBatisConfig.xml</code>）中进行导入并配置：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    导入外部配置文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"db.properties"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">            ...</span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--注意：这里必须是username,一定要规范--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><em>注*</em>：如果同一个属性<code>property</code>在多个地方都定义了，那么其读取顺序为：标签<code>properties</code>内部指定的属性 &gt; <code>resource</code>/<code>url</code> 属性中指定的配置文件 &gt; 方法参数。因此，方法参数的优先级最高。</p></li><li><p><strong><a href="http://www.mybatis.org/mybatis-3/configuration.html#typeAliases" target="_blank" rel="noopener">typeAliases</a></strong>：类型别名是为 Java 类型设置一个短的名字。 它只和 XML 配置有关，存在的意义仅在于用来减少类完全限定名的冗余。例如：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- type指定类全限定名，alias指定别名，且别名不区分大小写--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">"com.yn.bean.Student"</span> <span class="attr">alias</span>=<span class="string">"student"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure><p>另一种更简便的配置别名的方法是使用标签<code>package</code>：<a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 会自动搜索<code>package</code>标签指定包名下面的所有 Java Bean，并将别名设置为其类名：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 类名即为别名，且不区分大小写--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.yn.bean"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><em>注*</em>：使用<code>package</code>标签后，如果不想使用类名作为别名，则可以在使用<code>@Alias</code>注解自定义别名：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Alias</span>(<span class="string">"student"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后，就可以在任何使用<code>com.yn.bean.Student</code>的配置文件中，更改为使用别名：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.yn.interfaces.IStudentsDao"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"add"</span> <span class="attr">parameterType</span>=<span class="string">"student"</span>&gt;</span></span><br><span class="line">        insert into students(name,sex,cls) values(#&#123;name&#125;,#&#123;sex&#125;,#&#123;cls&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"update"</span> <span class="attr">parameterType</span>=<span class="string">"Student"</span>&gt;</span></span><br><span class="line">        update students set sex=#&#123;sex&#125;,cls=#&#123;cls&#125; where name=#&#123;name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectAll"</span> <span class="attr">resultType</span>=<span class="string">"student"</span>&gt;</span></span><br><span class="line">        select * from students</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 中已经为我们内置了许多 Java 类型的别名，具体如下表所示：</p></li></ul><table><thead><tr><th align="center">Alias</th><th align="center">Mapped Type</th></tr></thead><tbody><tr><td align="center">_byte</td><td align="center">byte</td></tr><tr><td align="center">_long</td><td align="center">long</td></tr><tr><td align="center">_short</td><td align="center">short</td></tr><tr><td align="center">_int</td><td align="center">int</td></tr><tr><td align="center">_integer</td><td align="center">int</td></tr><tr><td align="center">_double</td><td align="center">double</td></tr><tr><td align="center">_float</td><td align="center">float</td></tr><tr><td align="center">_boolean</td><td align="center">boolean</td></tr><tr><td align="center">string</td><td align="center">String</td></tr><tr><td align="center">byte</td><td align="center">Byte</td></tr><tr><td align="center">long</td><td align="center">Long</td></tr><tr><td align="center">short</td><td align="center">Short</td></tr><tr><td align="center">int</td><td align="center">Integer</td></tr><tr><td align="center">integer</td><td align="center">Integer</td></tr><tr><td align="center">double</td><td align="center">Double</td></tr><tr><td align="center">float</td><td align="center">Float</td></tr><tr><td align="center">boolean</td><td align="center">Boolean</td></tr><tr><td align="center">date</td><td align="center">Date</td></tr><tr><td align="center">decimal</td><td align="center">BigDecimal</td></tr><tr><td align="center">bigdecimal</td><td align="center">BigDecimal</td></tr><tr><td align="center">object</td><td align="center">Object</td></tr><tr><td align="center">map</td><td align="center">Map</td></tr><tr><td align="center">hashmap</td><td align="center">HashMap</td></tr><tr><td align="center">list</td><td align="center">List</td></tr><tr><td align="center">arraylist</td><td align="center">ArrayList</td></tr><tr><td align="center">collection</td><td align="center">Collection</td></tr><tr><td align="center">iterator</td><td align="center">Iterator</td></tr></tbody></table><ul><li><strong><a href="http://www.mybatis.org/mybatis-3/configuration.html#mappers" target="_blank" rel="noopener">mappers</a></strong>：映射器配置文件内部定义了 SQL 映射语句，因此我们需要将这些映射文件告诉 <a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a>，可以使用相对于类路径的资源引用， 或完全限定资源定位符（包括 file:/// 的 URL），或类名和包名等。例如：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用相对于类路径的资源引用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"org/mybatis/builder/AuthorMapper.xml"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"org/mybatis/builder/BlogMapper.xml"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"org/mybatis/builder/PostMapper.xml"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 使用完全限定资源定位符（URL） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">"file:///var/mappers/AuthorMapper.xml"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">"file:///var/mappers/BlogMapper.xml"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">"file:///var/mappers/PostMapper.xml"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 使用映射器接口实现类的完全限定类名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">"org.mybatis.builder.AuthorMapper"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">"org.mybatis.builder.BlogMapper"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">"org.mybatis.builder.PostMapper"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 将包内的映射器接口实现全部注册为映射器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"org.mybatis.builder"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="映射器配置文件"><a href="#映射器配置文件" class="headerlink" title="映射器配置文件"></a><a href="www.mybatis.org/mybatis-3/sqlmap-xml.html">映射器配置文件</a></h2><p>下面对 <a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 的配置 SQL 映射语句的映射文件（即：<code>IStudentsDao.xml</code>）中的常用配置选项进行讲解：</p><ul><li><strong><a href="http://www.mybatis.org/mybatis-3/sqlmap-xml.html#select" target="_blank" rel="noopener">select</a></strong>： 映射查询语句，如下所示：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectPerson"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"hashmap"</span>&gt;</span></span><br><span class="line">  SELECT * FROM PERSON WHERE ID = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>这个语句被称作<code>selectPerson</code>，接受一个<code>int</code>（或<code>Integer</code>）类型的参数，并返回一个<code>HashMap</code>类型的对象，其中的键是列名，值便是结果行中的对应值。</li></ul><p><code>&lt;select&gt;</code>标签的属性及其作用如下表所示：</p><table><thead><tr><th align="center">属性</th><th align="left">描述</th></tr></thead><tbody><tr><td align="center"><code>id</code></td><td align="left">在命名空间中唯一的标识符，可以被用来引用这条语句。</td></tr><tr><td align="center"><code>parameterType</code></td><td align="left">将会传入这条语句的参数类的完全限定名或别名。这个属性是可选的，因为 <a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 可以通过类型处理器（<code>TypeHandler</code>） 推断出具体传入语句的参数，默认值为未设置（<code>unset</code>）。</td></tr><tr><td align="center"><code>resultType</code></td><td align="left">从这条语句中返回的期望类型的类的完全限定名或别名。 <strong>注意如果返回的是集合，那应该设置为集合包含的类型，而不是集合本身</strong>。可以使用 <code>resultType</code> 或 <code>resultMap</code>，但不能同时使用。</td></tr><tr><td align="center"><code>resultMap</code></td><td align="left">外部 <code>resultMap</code> 的命名引用。结果集的映射是 <a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 最强大的特性，如果你对其理解透彻，许多复杂映射的情形都能迎刃而解。可以使用 <code>resultMap</code> 或 <code>resultType</code>，但不能同时使用。</td></tr><tr><td align="center"><code>flushCache</code></td><td align="left">将其设置为 <code>true</code> 后，只要语句被调用，都会导致本地缓存和二级缓存被清空，默认值：<code>false</code>。</td></tr><tr><td align="center"><code>useCache</code></td><td align="left">将其设置为 <code>true</code> 后，将会导致本条语句的结果被二级缓存缓存起来，默认值：对 select 元素为 <code>true</code>。</td></tr><tr><td align="center"><code>timeout</code></td><td align="left">这个设置是在抛出异常之前，驱动程序等待数据库返回请求结果的秒数。默认值为未设置（<code>unset</code>）（依赖驱动）。</td></tr><tr><td align="center"><code>fetchSize</code></td><td align="left">这是一个给驱动的提示，尝试让驱动程序每次批量返回的结果行数和这个设置值相等。 默认值为未设置（<code>unset</code>）（依赖驱动）。</td></tr><tr><td align="center"><code>statementType</code></td><td align="left"><code>STATEMENT</code>，<code>PREPARED</code>或<code>CALLABLE</code> 中的一个。这会让 <a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 分别使用<code>Statement</code>，<code>PreparedStatement</code>或<code>CallableStatement</code>，默认值：<code>PREPARED</code>。</td></tr><tr><td align="center"><code>resultSetType</code></td><td align="left"><code>FORWARD_ONLY</code>，<code>SCROLL_SENSITIVE</code>, <code>SCROLL_INSENSITIVE</code> 或 <code>DEFAULT</code>（等价于 <code>unset</code>） 中的一个，默认值为 <code>unset</code> （依赖驱动）。</td></tr><tr><td align="center"><code>databaseId</code></td><td align="left">如果配置了数据库厂商标识（databaseIdProvider），<a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 会加载所有的不带 <code>databaseId</code> 或匹配当前 <code>databaseId</code> 的语句；如果带或者不带的语句都有，则不带的会被忽略。</td></tr><tr><td align="center"><code>resultOrdered</code></td><td align="left">这个设置仅针对嵌套结果 select 语句适用：如果为 <code>true</code>，就是假设包含了嵌套结果集或是分组，这样的话当返回一个主结果行的时候，就不会发生有对前面结果集的引用的情况。 这就使得在获取嵌套的结果集的时候不至于导致内存不够用。默认值：<code>false</code>。</td></tr><tr><td align="center"><code>resultSets</code></td><td align="left">这个设置仅对多结果集的情况适用。它将列出语句执行后返回的结果集并给每个结果集一个名称，名称是逗号分隔的。</td></tr></tbody></table><ul><li><strong><a href="http://www.mybatis.org/mybatis-3/sqlmap-xml.html#insert_update_and_delete" target="_blank" rel="noopener">insert, update 和 delete</a></strong>：数据变更语句 insert，update 和 delete 的实现非常接近：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span></span></span><br><span class="line"><span class="tag">  <span class="attr">id</span>=<span class="string">"insertAuthor"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">parameterType</span>=<span class="string">"domain.blog.Author"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">flushCache</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">statementType</span>=<span class="string">"PREPARED"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">keyProperty</span>=<span class="string">""</span></span></span><br><span class="line"><span class="tag">  <span class="attr">keyColumn</span>=<span class="string">""</span></span></span><br><span class="line"><span class="tag">  <span class="attr">useGeneratedKeys</span>=<span class="string">""</span></span></span><br><span class="line"><span class="tag">  <span class="attr">timeout</span>=<span class="string">"20"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span></span></span><br><span class="line"><span class="tag">  <span class="attr">id</span>=<span class="string">"updateAuthor"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">parameterType</span>=<span class="string">"domain.blog.Author"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">flushCache</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">statementType</span>=<span class="string">"PREPARED"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">timeout</span>=<span class="string">"20"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span></span></span><br><span class="line"><span class="tag">  <span class="attr">id</span>=<span class="string">"deleteAuthor"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">parameterType</span>=<span class="string">"domain.blog.Author"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">flushCache</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">statementType</span>=<span class="string">"PREPARED"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">timeout</span>=<span class="string">"20"</span>&gt;</span></span><br></pre></td></tr></table></figure><code>&lt;insert&gt;</code>，<code>&lt;update&gt;</code>和<code>&lt;delete&gt;</code>标签的属性及其作用如下表所示：</li></ul><table><thead><tr><th align="center">属性</th><th align="left">描述</th></tr></thead><tbody><tr><td align="center"><code>id</code></td><td align="left">命名空间中的唯一标识符，可被用来代表这条语句。</td></tr><tr><td align="center"><code>parameterType</code></td><td align="left">将要传入语句的参数的完全限定类名或别名。这个属性是可选的，因为 <a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 可以通过类型处理器推断出具体传入语句的参数，默认值为未设置（<code>unset</code>）。</td></tr><tr><td align="center"><code>flushCache</code></td><td align="left">将其设置为 <code>true</code> 后，只要语句被调用，都会导致本地缓存和二级缓存被清空，默认值：<code>true</code>（对于 insert、update 和 delete 语句）。</td></tr><tr><td align="center"><code>timeout</code></td><td align="left">这个设置是在抛出异常之前，驱动程序等待数据库返回请求结果的秒数。默认值为未设置（<code>unset</code>）（依赖驱动）。</td></tr><tr><td align="center"><code>statementType</code></td><td align="left"><code>STATEMENT</code>，<code>PREPARED</code> 或 <code>CALLABLE</code> 的一个。这会让 <a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 分别使用 <code>Statement</code>，<code>PreparedStatement</code> 或 <code>CallableStatement</code>，默认值：<code>PREPARED</code>。</td></tr><tr><td align="center"><code>useGeneratedKeys</code></td><td align="left">（仅对 insert 和 update 有用）这会令 <a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 使用 JDBC 的 <code>getGeneratedKeys</code> 方法来取出由数据库内部生成的主键（比如：像 MySQL 和 SQL Server 这样的关系数据库管理系统的自动递增字段），默认值：false。</td></tr><tr><td align="center"><code>keyProperty</code></td><td align="left">（仅对 insert 和 update 有用）唯一标记一个属性，<a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 会通过 <code>getGeneratedKeys</code> 的返回值或者通过 insert 语句的 <code>selectKey</code> 子元素设置它的键值，默认值：未设置（<code>unset</code>）。如果希望得到多个生成的列，也可以是逗号分隔的属性名称列表。</td></tr><tr><td align="center"><code>keyColumn</code></td><td align="left">（仅对 insert 和 update 有用）通过生成的键值设置表中的列名，这个设置仅在某些数据库（像 PostgreSQL）是必须的，当主键列不是表中的第一列的时候需要设置。如果希望使用多个生成的列，也可以设置为逗号分隔的属性名称列表。</td></tr><tr><td align="center"><code>databaseId</code></td><td align="left">如果配置了数据库厂商标识（databaseIdProvider），<a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 会加载所有的不带 <code>databaseId</code> 或匹配当前 <code>databaseId</code> 的语句；如果带或者不带的语句都有，则不带的会被忽略。</td></tr></tbody></table><h2 id="动态-SQL"><a href="#动态-SQL" class="headerlink" title="动态 SQL"></a><a href="http://www.mybatis.org/mybatis-3/dynamic-sql.html" target="_blank" rel="noopener">动态 SQL</a></h2><p><a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 为我们提供了一些标签，方便我们进行 SQL 的动态拼接（动态 SQL）。</p><p>具体的标签及其功能如下：</p><ul><li><p><strong>if</strong>：动态 SQL 最常用处就是作为 where 子句的条件判断。比如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; IStudentsDao.java</span><br><span class="line">public interface IStudentsDao &#123;</span><br><span class="line">	...</span><br><span class="line">    List&lt;Student&gt; findStudentsByCondition(Student student);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; IStudentsDao.xml</span><br><span class="line">...</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.yn.interfaces.IStudentsDao&quot;&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;select id&#x3D;&quot;findStudentsByCondition&quot; parameterType&#x3D;&quot;Student&quot; resultMap&#x3D;&quot;studentResultMap&quot;&gt;</span><br><span class="line">        select * from students where 1&#x3D;1</span><br><span class="line">        &lt;if test&#x3D;&quot;name !&#x3D; null&quot;&gt;</span><br><span class="line">            and name&#x3D;#&#123;name&#125;</span><br><span class="line">        &lt;&#x2F;if&gt;</span><br><span class="line">        &lt;if test&#x3D;&quot;sex !&#x3D;null&quot;&gt;</span><br><span class="line">            and sex&#x3D;#&#123;sex&#125;</span><br><span class="line">        &lt;&#x2F;if&gt;</span><br><span class="line">        &lt;if test&#x3D;&quot;cls !&#x3D; 0&quot;&gt;</span><br><span class="line">            and class&#x3D;#&#123;cls&#125;</span><br><span class="line">        &lt;&#x2F;if&gt;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; IStudentsDaoTest.java</span><br><span class="line">    @Test</span><br><span class="line">    public void testFindStudentsByCondition() &#123;</span><br><span class="line">		...</span><br><span class="line">        Student student &#x3D; new Student();</span><br><span class="line">        student.setSex(&quot;male&quot;);</span><br><span class="line">        student.setCls(4);</span><br><span class="line">        List&lt;Student&gt; students &#x3D; this.studentsDaoProxy.findStudentsByCondition(student);</span><br><span class="line">        for(Student stu: students)&#123;</span><br><span class="line">            System.out.println(stu);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>where</strong>：见名知意，该标签用于替换 where 子句。正如我们上面那个例子，如果直接使用 where 子句进行 <strong>if</strong> 判断，我们需要手动添加一个为”真“的条件，这样当 <strong>if</strong> 判断失败时，还能确保 SQL 语句的正确性，但使用 <strong>where</strong> 标签，就可以省略这冗余操作：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findStudentsByCondition"</span> <span class="attr">parameterType</span>=<span class="string">"Student"</span> <span class="attr">resultMap</span>=<span class="string">"studentResultMap"</span>&gt;</span></span><br><span class="line">    select * from students</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"name != null"</span>&gt;</span></span><br><span class="line">            and name=#&#123;name&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"sex !=null"</span>&gt;</span></span><br><span class="line">            and sex=#&#123;sex&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"cls != 0"</span>&gt;</span></span><br><span class="line">            and class=#&#123;cls&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>foreach</strong>：动态 SQL 的另一个常用操作就是对一个集合进行遍历，通常实在构建 IN 条件语句时使用。比如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; StudentVo.java</span><br><span class="line">public class StudentVo &#123;</span><br><span class="line">    private List&lt;Integer&gt; studentIds;</span><br><span class="line"></span><br><span class="line">    public List&lt;Integer&gt; getStudentIds() &#123;</span><br><span class="line">        return studentIds;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setStudentIds(List&lt;Integer&gt; studentIds) &#123;</span><br><span class="line">        this.studentIds &#x3D; studentIds;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; IStudentDao.java</span><br><span class="line">public interface IStudentsDao &#123;</span><br><span class="line">	...</span><br><span class="line">    List&lt;Student&gt; findStudentsInIds(StudentVo vo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; IStudentDao.xml</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.yn.interfaces.IStudentsDao&quot;&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;select id&#x3D;&quot;findStudentsInIds&quot; parameterType&#x3D;&quot;StudentVo&quot; resultMap&#x3D;&quot;studentResultMap&quot;&gt;</span><br><span class="line">        select * from students</span><br><span class="line">        &lt;where&gt;</span><br><span class="line">            &lt;if test&#x3D;&quot;studentIds !&#x3D; null and studentIds.size() &gt; 0&quot;&gt;</span><br><span class="line">                &lt;foreach collection&#x3D;&quot;studentIds&quot; open&#x3D;&quot;id in (&quot; close&#x3D;&quot;)&quot; item&#x3D;&quot;id&quot; separator&#x3D;&quot;,&quot;&gt;</span><br><span class="line">                    #&#123;id&#125;</span><br><span class="line">                &lt;&#x2F;foreach&gt;</span><br><span class="line">            &lt;&#x2F;if&gt;</span><br><span class="line">        &lt;&#x2F;where&gt;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; IStudentDaoTest.java</span><br><span class="line">    @Test</span><br><span class="line">    public void testFindStudentsInIds() &#123;</span><br><span class="line">        List&lt;Integer&gt; ids &#x3D; Arrays.asList(1,2,3,4);</span><br><span class="line">        StudentVo vo &#x3D; new StudentVo();</span><br><span class="line">        vo.setStudentIds(ids);</span><br><span class="line">        List&lt;Student&gt; students &#x3D; this.studentsDaoProxy.findStudentsInIds(vo);</span><br><span class="line">        for(Student student : students)&#123;</span><br><span class="line">            System.out.println(student);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p><em>foreach*</em> 标签中的<code>collection</code>属性用于指定集合对象，在我们上面的例子里就是<code>StudentVo.studentIds</code>。<code>open</code>+<code>item</code>+<code>separator</code>+<code>close</code>组合而成我们的SQL 查询语句，上面完整的 SQL 语句如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> students <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">in</span> (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>);</span><br></pre></td></tr></table></figure></li><li><p><strong>sql</strong>：该标签可以抽取出重复 SQL 语句，用于复用。如下所示：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;sql id="defaultSelect"&gt;</span><br><span class="line">	<span class="keyword">select</span> * <span class="keyword">from</span> students</span><br><span class="line">&lt;/<span class="keyword">sql</span>&gt;</span><br><span class="line">&lt;<span class="keyword">select</span> <span class="keyword">id</span>=<span class="string">"selectAll"</span> resultMap=<span class="string">"studentResultMap"</span>&gt;</span><br><span class="line">	&lt;<span class="keyword">include</span> refid=<span class="string">"defaultSelect"</span>/&gt;</span><br><span class="line">&lt;/<span class="keyword">select</span>&gt;</span><br></pre></td></tr></table></figure><p>更多动态 SQL 标签，请查看：<a href="http://www.mybatis.org/mybatis-3/dynamic-sql.html" target="_blank" rel="noopener">dynamic-sql</a></p></li></ul><h2 id="数据库表间关联"><a href="#数据库表间关联" class="headerlink" title="数据库表间关联"></a>数据库表间关联</h2><p>在关系型数据中，表与表之间存在三种关系：一对一，一对多（多对一）和多对多。下面我们分别针对这三种关联关系给出具体配置。</p><p>前提：还是以上文入门案例作为示例，入门案例中已有一张表<code>students</code>，下面我们再创建一张表<code>classes</code>,并将字段<code>stu_id</code>作为指向表<code>students.id</code>的外键：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> <span class="string">`classes`</span> (</span><br><span class="line">    -&gt; <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    -&gt; <span class="string">`name`</span> <span class="built_in">VARCHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    -&gt; <span class="string">`stu_id`</span> <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    -&gt; PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">    -&gt; <span class="keyword">KEY</span> <span class="string">`stu_id`</span> (<span class="string">`stu_id`</span>),</span><br><span class="line">    -&gt; <span class="keyword">CONSTRAINT</span> <span class="string">`stu_id`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`stu_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`students`</span> (<span class="string">`id`</span>)</span><br><span class="line">    -&gt; ) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure><p>创建完表<code>classes</code>后，顺便插入几条数据：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> classes(<span class="keyword">name</span>,stu_id) <span class="keyword">values</span>(<span class="string">'一班'</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> classes(<span class="keyword">name</span>,stu_id) <span class="keyword">values</span>(<span class="string">'二班'</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> classes(<span class="keyword">name</span>,stu_id) <span class="keyword">values</span>(<span class="string">'三班'</span>,<span class="number">3</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> classes(<span class="keyword">name</span>,stu_id) <span class="keyword">values</span>(<span class="string">'四班'</span>,<span class="number">4</span>);</span><br></pre></td></tr></table></figure><p>然后，修改下<code>students</code>表：<br>1）先将表<code>students</code>的字段<code>cls</code>改为<code>class_id</code>：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> students <span class="keyword">change</span> <span class="keyword">column</span> cls class_id <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><p>2）然后将其列<code>class_id</code>修改为指向表<code>classes.id</code>的外键：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 禁用外键约束</span><br><span class="line">set foreign_key_checks&#x3D;0;</span><br><span class="line"># 修改列</span><br><span class="line">alter table students add constraint class_id foreign key(class_id) refererences classes(id);</span><br><span class="line"># 启用外键约束</span><br><span class="line">set foreign_key_checks&#x3D;1;</span><br></pre></td></tr></table></figure><p>至此，现数据库中总共有2张表：<code>students</code>和<code>classes</code>，且<code>students.class_id</code>指向表<code>classes.id</code>，表<code>classes.stu_id</code>指向表<code>students.id</code>。</p><p>最后，在 <a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 中以代码方式实现对表<code>classes</code>的操作，完整代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; com.yn.bean.Classes.java</span><br><span class="line">public class Classes implements Serializable &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String name;</span><br><span class="line">    private int studentId;</span><br><span class="line"></span><br><span class="line">    public int getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(int id) &#123;</span><br><span class="line">        this.id &#x3D; id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name &#x3D; name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getStudentId() &#123;</span><br><span class="line">        return studentId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setStudentId(int studentId) &#123;</span><br><span class="line">        this.studentId &#x3D; studentId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Classes&#123;&quot; +</span><br><span class="line">                &quot;id&#x3D;&quot; + id +</span><br><span class="line">                &quot;, name&#x3D;&#39;&quot; + name + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, studentId&#x3D;&quot; + studentId +</span><br><span class="line">                &#39;&#125;&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; com.yn.interfaces.IClassesDao.java</span><br><span class="line">public interface IClassesDao &#123;</span><br><span class="line">&#x2F;&#x2F;    查：查询所有</span><br><span class="line">    List&lt;Classes&gt; selectAll();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 全局配置文件：MyBatis.xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">	&lt;!--直接使用 package 标签导入全部配置映射文件--&gt;</span><br><span class="line">        &lt;package name&#x3D;&quot;com.yn.interfaces&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;mappers&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; resources&#x2F;com&#x2F;yn&#x2F;interfaces&#x2F;IClassesDao.xml</span><br><span class="line">...</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.yn.interfaces.IClassesDao&quot;&gt;</span><br><span class="line">    &lt;resultMap id&#x3D;&quot;classesMap&quot; type&#x3D;&quot;com.yn.bean.Classes&quot;&gt;</span><br><span class="line">        &lt;id property&#x3D;&quot;id&quot; column&#x3D;&quot;id&quot; &#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;name&quot; column&#x3D;&quot;name&quot; &#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;studentId&quot; column&#x3D;&quot;stu_id&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id&#x3D;&quot;selectAll&quot; resultMap&#x3D;&quot;classesMap&quot;&gt;</span><br><span class="line">        select * from classes;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure><p>到此，我们的准备工作已算完成了，接下来就可以开始进入 <a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 建立表关联操作的实操。</p><ul><li><strong>一对一关联</strong>：一个学生对应一个班级，因此，学生表<code>students</code>与班级表<code>classes</code>的关联关系即为一对一。具体到 <a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 中，这种关联体现的实现步骤如下:</li></ul><ol><li>表<code>students</code>对应的 POJO 类为<code>Student</code>，每个学生对应一个班级，因此，学生和班级的一对一关联关系在 Java 代码的体现只需为类<code>Student</code>内部添加一个<code>Classes</code>成员即可：<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// com.yn.bean.Student.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> classId;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    一对一关联：一个学生对应一个班级</span></span><br><span class="line">    <span class="keyword">private</span> Classes cls;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Classes <span class="title">getCls</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cls;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCls</span><span class="params">(Classes cls)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cls = cls;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">``` </span><br><span class="line"><span class="number">2</span>. 然后配置映射文件使用标签`association`表示一对一关联：</span><br><span class="line">```xml</span><br><span class="line">&lt;mapper namespace=<span class="string">"com.yn.interfaces.IStudentsDao"</span>&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;resultMap id=<span class="string">"studentClassMap"</span> type=<span class="string">"com.yn.bean.Student"</span>&gt;</span><br><span class="line">        &lt;!--配置 Student 输出映射--&gt;</span><br><span class="line">        &lt;result property=<span class="string">"name"</span> column=<span class="string">"name"</span>/&gt;</span><br><span class="line">        &lt;result property=<span class="string">"sex"</span> column=<span class="string">"sex"</span>/&gt;</span><br><span class="line">        &lt;result property=<span class="string">"classId"</span> column=<span class="string">"class_id"</span>/&gt;</span><br><span class="line">        &lt;!--一对一关联：配置 Classes 输出映射--&gt;</span><br><span class="line">        &lt;association property=<span class="string">"cls"</span> column=<span class="string">"class_id"</span> javaType=<span class="string">"com.yn.bean.Classes"</span>&gt;</span><br><span class="line">            &lt;id property=<span class="string">"id"</span> column=<span class="string">"id"</span> /&gt;</span><br><span class="line">            &lt;!--select classes.name as classname--&gt;</span><br><span class="line">            &lt;result property=<span class="string">"name"</span> column=<span class="string">"classname"</span>/&gt;</span><br><span class="line">            &lt;!--这里可以不配置，因为 sql 语句并没有输出该字段内容--&gt;</span><br><span class="line">            &lt;result property=<span class="string">"studentId"</span> column=<span class="string">"stu_id"</span> /&gt;</span><br><span class="line">        &lt;/association&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=<span class="string">"selectAll"</span> resultMap=<span class="string">"studentClassMap"</span>&gt;</span><br><span class="line">        select s.*,c.name as classname from students s,classes c where s.class_id=c.id;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>到这里，我们就已经完成了一对一关联关系表的建立。</li></ol><ul><li><strong>一对多关联</strong>：一个班级可以有多个学生，因此班级表<code>classes</code>与学生表<code>students</code>的关系即为一对多关系。具体到 <a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 中，一对多的关联实现步骤如下所示：</li></ul><ol><li>由于一个班级有多个学生，此种一对多的关系在 Java 代码的体现就是：类<code>Classes</code>内部维护一个<code>Students</code>集合：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; com.yn.bean.Classes.java</span><br><span class="line">public class Classes implements Serializable &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String name;</span><br><span class="line">    private int studentId;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;    一对多关联：一个班级有多个学生</span><br><span class="line">    private List&lt;Student&gt; students;</span><br><span class="line"></span><br><span class="line">    public List&lt;Student&gt; getStudents() &#123;</span><br><span class="line">        return students;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setStudents(List&lt;Student&gt; students) &#123;</span><br><span class="line">        this.students &#x3D; students;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>然后配置映射文件中使用标签<code>collection</code>表示一对多关联：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// resources/com/yn/interfaces/IClassesDao.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.yn.interfaces.IClassesDao"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"classStudentsMap"</span> <span class="attr">type</span>=<span class="string">"com.yn.bean.Classes"</span>&gt;</span></span><br><span class="line">  	    <span class="comment">&lt;!--配置 Classes 字段映射--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">	    <span class="comment">&lt;!--select classes.name as classname--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"classname"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"studentId"</span> <span class="attr">column</span>=<span class="string">"stu_id"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--一对多关联：配置 Student 映射--&gt;</span></span><br><span class="line">	    <span class="comment">&lt;!--ofType表示集合内部元素--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"students"</span> <span class="attr">ofType</span>=<span class="string">"com.yn.bean.Student"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sex"</span> <span class="attr">column</span>=<span class="string">"sex"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"classId"</span> <span class="attr">column</span>=<span class="string">"class_id"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectAll"</span> <span class="attr">resultMap</span>=<span class="string">"classStudentsMap"</span>&gt;</span></span><br><span class="line">        select * from classes</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>到这里，我们就已经完成了一对多关联关系的建立。</li></ol><p>在讲解 <strong>多对多关联</strong> 前，我们先创建2张表：</p><ol><li>老师表<code>teachers</code>，用于存储教师信息：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists teachers (</span><br><span class="line">    -&gt; id int primary key auto_increment,</span><br><span class="line">    -&gt; name varchar(20) not null,</span><br><span class="line">    -&gt; sex varchar(10) default &#39;male&#39;</span><br><span class="line">    -&gt; ) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br><span class="line"></span><br><span class="line"># 插入一些数据</span><br><span class="line">insert into teachers(name,sex) values(&#39;张三&#39;,&#39;male&#39;);</span><br><span class="line">insert into teachers(name,sex) values(&#39;李四&#39;,&#39;female&#39;);</span><br><span class="line">insert into teachers(name,sex) values(&#39;王五&#39;,&#39;male&#39;);</span><br></pre></td></tr></table></figure></li><li>然后需要再创建一张中间表（因为多对多关联需要一张中间表进行连接），称为：<code>stu_tea</code>，其内部之包含两个字段：<code>sid</code>和<code>tid</code>，分别作为指向表<code>studnets.id</code>和表<code>teachers.id</code>的外键：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists &#96;stu_tea&#96; (</span><br><span class="line">	-&gt; &#96;sid&#96; int not null,</span><br><span class="line">	-&gt;  &#96;tid&#96; int not null,</span><br><span class="line">	-&gt;  primary key (&#96;sid&#96;,&#96;tid&#96;),</span><br><span class="line">	-&gt; foreign key (&#96;sid&#96;) references &#96;students&#96; (&#96;id&#96;),</span><br><span class="line">	-&gt; foreign key (&#96;tid&#96;) references &#96;teachers&#96; (&#96;id&#96;)</span><br><span class="line">	-&gt; ) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br><span class="line"></span><br><span class="line"># 插入一些数据</span><br><span class="line">insert into stu_tea (sid,tid) values (1,1),(1,3),(2,2),(4,1),(4,2);</span><br></pre></td></tr></table></figure></li></ol><ul><li><strong>多对多关联</strong>： 一个学生可以有多个老师，一个老师也可以有多个学生。因此，老师与学生的关系是多对多关联。</li></ul><ol><li>首先从老师角度来说，其对应多个学生，在 Java 代码上的体现为：POJO 类<code>Teacher</code>内部维护一个<code>Student</code>集合，完整代码如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; com.yn.bean.Teacher.java</span><br><span class="line">public class Teacher implements Serializable &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String name;</span><br><span class="line">    private String sex;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;    多对多关联：一个老师对应多个学生</span><br><span class="line">    private List&lt;Student&gt; students;</span><br><span class="line">    </span><br><span class="line">    public List&lt;Student&gt; getStudents() &#123;</span><br><span class="line">        return students;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setStudents(List&lt;Student&gt; students) &#123;</span><br><span class="line">        this.students &#x3D; students;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(int id) &#123;</span><br><span class="line">        this.id &#x3D; id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name &#x3D; name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSex() &#123;</span><br><span class="line">        return sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSex(String sex) &#123;</span><br><span class="line">        this.sex &#x3D; sex;</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Teacher&#123;&quot; +</span><br><span class="line">                &quot;id&#x3D;&quot; + id +</span><br><span class="line">                &quot;, name&#x3D;&#39;&quot; + name + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, sex&#x3D;&#39;&quot; + sex + &#39;\&#39;&#39; +</span><br><span class="line">                &#39;&#125;&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; com.yn.interfaces.ITeacherDao.java</span><br><span class="line">public interface ITeacherDao &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;Teacher&gt; selectAll();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 全局配置文件：resources&#x2F;MyBatisConfig.xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;package name&#x3D;&quot;com.yn.interfaces&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;mappers&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; com.yn.interfaces.ITeacherDao.xml</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.yn.interfaces.ITeacherDao&quot;&gt;</span><br><span class="line">    &lt;resultMap id&#x3D;&quot;teacherStudentsMap&quot; type&#x3D;&quot;com.yn.bean.Teacher&quot;&gt;</span><br><span class="line">        &lt;id property&#x3D;&quot;id&quot; column&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;name&quot; column&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;sex&quot; column&#x3D;&quot;sex&quot;&#x2F;&gt;</span><br><span class="line">        &lt;collection property&#x3D;&quot;students&quot; ofType&#x3D;&quot;com.yn.bean.Student&quot;&gt;</span><br><span class="line">            &lt;!--select students.name as sname--&gt;</span><br><span class="line">            &lt;result property&#x3D;&quot;name&quot; column&#x3D;&quot;sname&quot;&#x2F;&gt;</span><br><span class="line">            &lt;!--select students.sex as ssex--&gt;</span><br><span class="line">            &lt;result property&#x3D;&quot;sex&quot; column&#x3D;&quot;ssex&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result property&#x3D;&quot;classId&quot; column&#x3D;&quot;class_id&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;collection&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id&#x3D;&quot;selectAll&quot; resultMap&#x3D;&quot;teacherStudentsMap&quot;&gt;</span><br><span class="line">        select t.*,s.name as sname,s.sex as ssex,s.class_id from teachers t</span><br><span class="line">        left outer join stu_tea st on t.id&#x3D;st.tid</span><br><span class="line">        left outer join students s on s.id&#x3D;st.sid</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; junit test</span><br><span class="line">@Test</span><br><span class="line">public void selectAll() &#123;</span><br><span class="line">	List&lt;Teacher&gt; teachers &#x3D; this.teacherDaoProxy.selectAll();</span><br><span class="line">	for(Teacher teacher: teachers)&#123;</span><br><span class="line">		System.out.println(teacher);</span><br><span class="line">		for(Student s : teacher.getStudents())&#123;</span><br><span class="line">			System.out.println(s);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>从学生角度来讲，其对应多个老师，在 Java 代码上的体现为：POJO 类<code>Student</code>内部维护一个<code>Teacher</code>集合：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; com.yn.bean.Student.java</span><br><span class="line">public class Student implements Serializable &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private String sex;</span><br><span class="line">    private int classId;</span><br><span class="line">&#x2F;&#x2F;    一对一关联：一个学生对应一个班级</span><br><span class="line">    private Classes cls;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;    多对多关联：一个学生对应多个老师</span><br><span class="line">    private List&lt;Teacher&gt; teachers;</span><br><span class="line"></span><br><span class="line">    public List&lt;Teacher&gt; getTeachers() &#123;</span><br><span class="line">        return teachers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setTeachers(List&lt;Teacher&gt; teachers) &#123;</span><br><span class="line">        this.teachers &#x3D; teachers;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; com.yn.interfaces.IStudentsDao.xml</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.yn.interfaces.IStudentsDao&quot;&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;resultMap id&#x3D;&quot;studentTeachersMap&quot; type&#x3D;&quot;com.yn.bean.Student&quot;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;name&quot; column&#x3D;&quot;name&quot; &#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;sex&quot; column&#x3D;&quot;sex&quot; &#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;classId&quot; column&#x3D;&quot;class_id&quot; &#x2F;&gt;</span><br><span class="line">        &lt;collection property&#x3D;&quot;teachers&quot; ofType&#x3D;&quot;com.yn.bean.Teacher&quot;&gt;</span><br><span class="line">            &lt;!--select teachers.name as tname--&gt;</span><br><span class="line">            &lt;result property&#x3D;&quot;name&quot; column&#x3D;&quot;tname&quot; &#x2F;&gt;</span><br><span class="line">            &lt;!--select teachers.sex as tsex--&gt;</span><br><span class="line">            &lt;result property&#x3D;&quot;sex&quot; column&#x3D;&quot;tsex&quot; &#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;collection&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id&#x3D;&quot;selectAll&quot; resultMap&#x3D;&quot;studentTeachersMap&quot;&gt;</span><br><span class="line">        select s.name,s.sex,s.class_id,t.name as tname,t.sex as tsex from students s</span><br><span class="line">        left outer join stu_tea st on s.id&#x3D;st.sid</span><br><span class="line">        left outer join teachers t on t.id &#x3D;st.tid</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; junit test</span><br><span class="line">@Test</span><br><span class="line">public void testSelectAll() throws IOException &#123;</span><br><span class="line">	List&lt;Student&gt; students &#x3D; this.studentsDaoProxy.selectAll();</span><br><span class="line">	for (Student student : students) &#123;</span><br><span class="line">		System.out.println(student);</span><br><span class="line">		for(Teacher teacher : student.getTeachers())&#123;</span><br><span class="line">			System.out.println(teacher);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>到此，<a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 中对于数据库表间的关联关系处理已基本完成。</li></ol><h2 id="关联表加载模式"><a href="#关联表加载模式" class="headerlink" title="关联表加载模式"></a>关联表加载模式</h2><p>首先了解下两个概念：</p><ul><li><strong>立即加载</strong>：表间关联时，加载主表时，同时加载关联表。</li><li><strong>延迟加载</strong>：也即按需加载，关联表数据只有在使用到的时候，才进行加载。</li></ul><p>正如我们上文提到的关系型数据库中，各表间可能存在一定的关联关系。比如一对多关联时，当我们查询主表数据时，此时对于关联表而言，就存在两种操作：<br>1）<strong>立即加载</strong>：查询主表数据时，同时也对关联表数据进行查询。即主副表查询是<strong>同步</strong>的。<br>2）<strong>延迟加载</strong>：查询主表数据时，不进行关联表数据查询。后续要使用到关联表数据时，才进行查询。即主副表查询是<strong>异步</strong>的。</p><p>通常而言，对于 N对一 的关联关系，建议使用 <strong>立即加载</strong>（可认为关联表数据量小）。<br>对于 N对多 的关联关系，建议使用 <strong>延迟加载</strong>（可认为关联表数据量大）。</p><p>在 <a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 中，开启延迟加载的步骤如下：</p><ol><li>首先在全局配置文件中开启全局延迟加载模式：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; resources&#x2F;MyBatisConfig.xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">&lt;!--    导入外部配置文件--&gt;</span><br><span class="line">    &lt;properties resource&#x3D;&quot;db.properties&quot; &#x2F;&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;settings&gt;</span><br><span class="line">        &lt;!--延迟加载：true--&gt;</span><br><span class="line">        &lt;setting name&#x3D;&quot;lazyLoadingEnabled&quot; value&#x3D;&quot;true&quot;&#x2F;&gt;</span><br><span class="line">        &lt;!--立即加载：false--&gt;</span><br><span class="line">        &lt;setting name&#x3D;&quot;aggressiveLazyLoading&quot; value&#x3D;&quot;false&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;settings&gt;</span><br><span class="line">	...</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure></li><li>通过提供<code>select</code>属性，配置关联表的数据获取（延迟）方法，因为是关系型数据库，关联表的数据获取通常都是通过主表的外键作为其参数，所提提供的方法的参数即为主表外键值，其由<code>column</code>属性指定。</li></ol><p>比如，按上文学生表<code>students</code>和班级表<code>classes</code>的一对一关联来说，其配置如下：<br>1）因为要开启延迟加载，因此主表（即表<code>students</code>）操作（SQL 语句）不需要考虑关联表：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--com&#x2F;yn&#x2F;interfaces&#x2F;IStudentsDao.xml--&gt;</span><br><span class="line">&lt;select id&#x3D;&quot;selectAll&quot; resultMap&#x3D;&quot;studentClassMap&quot;&gt;</span><br><span class="line">	select * from students</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure><p>2）然后，关联表（即表<code>classes</code>）要提供关联查询方法，因主表（即表<code>students</code>）是通过外键（<code>class_id</code>）关联副表（即表<code>classes</code>），因此副表需要提供<code>selectById(int cid)</code>方法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; com.yn.interfaces.IStudentsDao.java</span><br><span class="line">public interface IClassesDao &#123;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;    查：查询所有</span><br><span class="line">    List&lt;Classes&gt; selectAll();</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;    提供通过班级id 关联查询方法</span><br><span class="line">    Classes selectById(Integer cid);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;!--com&#x2F;yn&#x2F;interfaces&#x2F;IClassesDao.xml--&gt;</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.yn.interfaces.IClassesDao&quot;&gt;</span><br><span class="line">    &lt;resultMap id&#x3D;&quot;classesMap&quot; type&#x3D;&quot;com.yn.bean.Classes&quot;&gt;</span><br><span class="line">        &lt;id property&#x3D;&quot;id&quot; column&#x3D;&quot;id&quot; &#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;name&quot; column&#x3D;&quot;name&quot; &#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;studentId&quot; column&#x3D;&quot;stu_id&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id&#x3D;&quot;selectById&quot; parameterType&#x3D;&quot;int&quot; resultMap&#x3D;&quot;classesMap&quot;&gt;</span><br><span class="line">        select * from classes where id&#x3D;#&#123;cid&#125;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure><p>3）最后，通过<code>select</code>属性和<code>column</code>属性为主表提供副表数据获取（延迟加载）方法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--com&#x2F;yn&#x2F;interfaces&#x2F;IStudentsDao.xml--&gt;</span><br><span class="line">&lt;resultMap id&#x3D;&quot;studentClassMap&quot; type&#x3D;&quot;com.yn.bean.Student&quot;&gt;</span><br><span class="line">	&lt;!--配置 Student 输出映射--&gt;</span><br><span class="line">	&lt;result property&#x3D;&quot;name&quot; column&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">	&lt;result property&#x3D;&quot;sex&quot; column&#x3D;&quot;sex&quot;&#x2F;&gt;</span><br><span class="line">	&lt;result property&#x3D;&quot;classId&quot; column&#x3D;&quot;class_id&quot;&#x2F;&gt;</span><br><span class="line">	&lt;!--一对一关联：配置 Classes 输出映射--&gt;</span><br><span class="line">	&lt;association property&#x3D;&quot;cls&quot; column&#x3D;&quot;class_id&quot; javaType&#x3D;&quot;com.yn.bean.Classes&quot; select&#x3D;&quot;com.yn.interfaces.IClassesDao.selectById&quot;&gt;</span><br><span class="line">	&lt;&#x2F;association&gt;</span><br><span class="line">&lt;&#x2F;resultMap&gt;</span><br></pre></td></tr></table></figure><p>到此，N对一 的配置就完成了。</p><p>而对于 N对多 的配置，其与 N对一 的配置是基本一致的。<br>比如还是按上文班级表<code>classes</code>和学生表<code>students</code>来说，他们是一对多的关系，即一个班级对应多个学生，那么其关联关系在 <a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 中的配置具体如下：<br>1）配置班级表<code>classes</code>数据获取 SQL 语句：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--com&#x2F;yn&#x2F;interfaces&#x2F;IClassesDao.xml--&gt;</span><br><span class="line">&lt;select id&#x3D;&quot;selectAll&quot; resultMap&#x3D;&quot;classStudentsMap&quot;&gt;</span><br><span class="line">	select * from classes</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure><p>2）配置表<code>students</code>依据班级<code>id</code>获取学生数据方法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; com.yn.interfaces.IStudentsDao.java</span><br><span class="line">public interface IStudentsDao &#123;</span><br><span class="line">	&#x2F;&#x2F; 一个班级 cid 对应多个学生</span><br><span class="line">    List&lt;Student&gt; selectById(Integer cid);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;!--com&#x2F;yn&#x2F;interfaces&#x2F;IStudentsDao.xml--&gt;</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.yn.interfaces.IStudentsDao&quot;&gt;</span><br><span class="line">    &lt;resultMap id&#x3D;&quot;studentResultMap&quot; type&#x3D;&quot;com.yn.bean.Student&quot;&gt;</span><br><span class="line">        &lt;constructor&gt;</span><br><span class="line">            &lt;arg column&#x3D;&quot;name&quot; javaType&#x3D;&quot;String&quot;&#x2F;&gt;</span><br><span class="line">            &lt;arg column&#x3D;&quot;sex&quot; javaType&#x3D;&quot;String&quot;&#x2F;&gt;</span><br><span class="line">            &lt;arg column&#x3D;&quot;class_id&quot; javaType&#x3D;&quot;_int&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;constructor&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;classId&quot; column&#x3D;&quot;class_id&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id&#x3D;&quot;selectById&quot; parameterType&#x3D;&quot;INT&quot; resultMap&#x3D;&quot;studentResultMap&quot;&gt;</span><br><span class="line">        select * from students where class_id&#x3D;#&#123;cid&#125;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure><p>3）最后，为主表配置副表数据加载方法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--com&#x2F;yn&#x2F;interfaces&#x2F;IClassesDao.xml--&gt;</span><br><span class="line">&lt;resultMap id&#x3D;&quot;classStudentsMap&quot; type&#x3D;&quot;com.yn.bean.Classes&quot;&gt;</span><br><span class="line">	&lt;id property&#x3D;&quot;id&quot; column&#x3D;&quot;id&quot; &#x2F;&gt;</span><br><span class="line">	&lt;result property&#x3D;&quot;name&quot; column&#x3D;&quot;name&quot; &#x2F;&gt;</span><br><span class="line">	&lt;result property&#x3D;&quot;studentId&quot; column&#x3D;&quot;stu_id&quot; &#x2F;&gt;</span><br><span class="line">	&lt;collection property&#x3D;&quot;students&quot; ofType&#x3D;&quot;com.yn.bean.Student&quot; column&#x3D;&quot;id&quot; select&#x3D;&quot;com.yn.interfaces.IStudentsDao.selectById&quot;&gt;</span><br><span class="line">	&lt;&#x2F;collection&gt;</span><br><span class="line">&lt;&#x2F;resultMap&gt;</span><br></pre></td></tr></table></figure><p>至此，N对多 的延迟加载特定已配置完成。</p><p><strong>注</strong>：我们上面在全局配置表中开启了全局延迟加载模式，所以对于所有的关联表，默认都会开启延迟加载，但是可以通过为标签<code>association</code>/<code>collection</code>添加<code>fetchType</code>来显示覆盖全局配置，其取值有两个：<code>eager</code>表示立即加载，<code>lazy</code>表示延迟加载。</p><p>比如，我们前面也提到过，对于 N对一 关联的数据库表，通常使用的是立即加载模式，那么我们就可以按如下配置，启动立即加载：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--com&#x2F;yn&#x2F;interfaces&#x2F;IStudentsDao.xml--&gt;</span><br><span class="line">&lt;resultMap id&#x3D;&quot;studentClassMap&quot; type&#x3D;&quot;com.yn.bean.Student&quot;&gt;</span><br><span class="line">	&lt;result property&#x3D;&quot;name&quot; column&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">	&lt;result property&#x3D;&quot;sex&quot; column&#x3D;&quot;sex&quot;&#x2F;&gt;</span><br><span class="line">	&lt;result property&#x3D;&quot;classId&quot; column&#x3D;&quot;class_id&quot;&#x2F;&gt;</span><br><span class="line"></span><br><span class="line">	&lt;association fetchType&#x3D;&quot;eager&quot; property&#x3D;&quot;cls&quot; column&#x3D;&quot;class_id&quot; javaType&#x3D;&quot;com.yn.bean.Classes&quot; select&#x3D;&quot;com.yn.interfaces.IClassesDao.selectById&quot;&gt;</span><br><span class="line">	&lt;&#x2F;association&gt;</span><br><span class="line">&lt;&#x2F;resultMap&gt;</span><br></pre></td></tr></table></figure><h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><p>对访问频繁且不常变化的数据进行缓存，可以减少与数据库的交互，提高执行效率。</p><p><a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 为我们提供了两种缓存功能：</p><ul><li><strong>一级缓存</strong>：也成为 <strong>本地缓存</strong>，由<code>SqlSession</code>对象实例负责缓存。使用同一个<code>SqlSession</code>实例进行同一查询，后续的查询结果都是从一级缓存中获取。但该<code>SqlSession</code>实例销毁时，缓存随之销毁。</li></ul><p><strong>注</strong>：对于一级缓存而言，其有如下特性：</p><ol><li>一级缓存默认开启</li><li>一级缓存其实内部是一个<code>Map</code>结构，其缓存的是对象实例（相应 POJO 类实例）</li><li>但调用<code>SqlSession</code>的增加，修改，删除，commit(),close()等方法时，其一级缓存会被清空</li></ol><ul><li><strong>二级缓存</strong>：由<code>SqlSessionFactory</code>对象实例负责缓存。由同一个<code>SqlSessionFactory</code>实例生产的<code>SqlSession</code>对象实例共享该二级缓存。</li></ul><p><strong>注</strong>：对于二级缓存而言，其有如下特性：</p><ol><li>二级缓存默认不开启。手动开启方法如下：<br>1）全局配置文件中开启二级缓存（可选操作，因为默认已开启）：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--resources&#x2F;MyBatisConfig.xml--&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;settings&gt;</span><br><span class="line">        &lt;!-- 开启二级缓存 --&gt;</span><br><span class="line">        &lt;setting name&#x3D;&quot;cacheEnabled&quot; value&#x3D;&quot;true&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;settings&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure>2）在当前配置映射文件中开启二级缓存：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--com&#x2F;yn&#x2F;interfaces&#x2F;IClassesDao.xml--&gt;</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.yn.interfaces.IClassesDao&quot;&gt;</span><br><span class="line">    &lt;!--配置映射文件开启二级缓存--&gt;</span><br><span class="line">    &lt;cache &#x2F;&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure>3）在当前数据库操作中开启二级缓存（注：POJO 类需要实现序列化接口）：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--com&#x2F;yn&#x2F;interfaces&#x2F;IClassesDao.xml--&gt;</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.yn.interfaces.IClassesDao&quot;&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;!--操作开启二级缓存--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;selectAll&quot; resultMap&#x3D;&quot;classStudentsMap&quot; useCache&#x3D;&quot;true&quot;&gt;</span><br><span class="line">        select * from classes</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure></li><li>二级缓存工作机制：在会话中，进行查询只会将结果保存到一级缓存中。只有当会话关闭时，才会将一级缓存的内容保存到二级缓存中（序列化）。</li><li><strong>二级缓存缓存的是数据（即序列化）</strong>,也即 SQL 操作从二级缓存获取数据后，再重新组装成对象实例（序列化）。而一级缓存直接缓存的就是对象实例。</li></ol><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>下面列举一些常用配置具体实现：</p><ul><li><p><strong>主键自增</strong>：对于插入语句，如果数据库支持自动生成主键的字段（比如 MySQL 和 SQL Server）：比如我们上文入门案例中的使用自增字段<code>id</code>作为表<code>students</code>的主键。那么此时，可以设置 <code>useGeneratedKeys=”true”</code>，然后再把<code>keyProperty</code>设置到目标属性上就 OK 了：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"add"</span> <span class="attr">parameterType</span>=<span class="string">"student"</span> <span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">    insert into students(name,sex,cls) values(#&#123;name&#125;,#&#123;sex&#125;,#&#123;cls&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果数据库还支持多行插入，那么我们可以传入一个<code>Student</code>数组或者集合，并返回自动生成的主键：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public interface IStudentsDao &#123;</span><br><span class="line">    ...</span><br><span class="line">    void addAll(List&lt;Student&gt; students);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!-- IStudentsDao.xml --&gt;</span><br><span class="line">&lt;insert id&#x3D;&quot;addAll&quot; parameterType&#x3D;&quot;java.util.List&quot; useGeneratedKeys&#x3D;&quot;true&quot; keyProperty&#x3D;&quot;id&quot;&gt;</span><br><span class="line">    insert into students(name,sex,cls) values</span><br><span class="line">    &lt;foreach collection&#x3D;&quot;list&quot; item&#x3D;&quot;stu&quot; separator&#x3D;&quot;,&quot;&gt;</span><br><span class="line">        (#&#123;stu.name&#125;,#&#123;stu.sex&#125;,#&#123;stu.cls&#125;)</span><br><span class="line">    &lt;&#x2F;foreach&gt;</span><br><span class="line">&lt;&#x2F;insert&gt;</span><br></pre></td></tr></table></figure></li><li><p><strong>结果映射</strong>：通常来说，我们自定义的 Java Bean 的成员应该与数据库表的字段名称一致，这样 <a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 就能自动地帮我们进行数据转换。但在实际开发中，往往会出现 Java Bean 的成员名称与数据库表字段名称不一致的情况：比如，我们将上文入门案例的数据库表<code>students</code>的<code>cls</code>字段更改为<code>class</code>：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> students <span class="keyword">change</span> <span class="keyword">column</span> cls <span class="keyword">class</span> <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><p>现在，<code>Student</code>的成员<code>cls</code>就无法匹配数据库表<code>students</code>的<code>class</code>字段了，我们先查看下表<code>students</code>的内容：</p></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/2222997-331ae7384a3dcc8b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><p>然后我们在运行一下获取操作：<code>selectAll()</code>，结果如下所示：</p><p><img src="https://upload-images.jianshu.io/upload_images/2222997-d2a615e70e49ad34.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><p>可以看到，数据库的<code>class</code>字段获取不到了。因此，这里我们需要配置<code>Student</code>的<code>cls</code>成员到数据库表<code>students</code>的<code>class</code>字段的映射：比如，我们可以通过更改 Sql 语句来让数据库表<code>students.class</code>字段映射到<code>Student.cls</code>：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectAll"</span> <span class="attr">resultType</span>=<span class="string">"student"</span>&gt;</span></span><br><span class="line">    select id,name,sex,class as cls from students</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>但是，Sql 语句的配置会显得繁琐些，尤其当需要配置字段较多的时候，因此，<a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">MyBatis</a> 已经为我们提供了相关方法（<code>resultMap</code>）解决这个问题，其具体配置如下所示：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.yn.interfaces.IStudentsDao"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置mysql表列名与实体类属性的映射关系--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"studentResultMap"</span> <span class="attr">type</span>=<span class="string">"com.yn.bean.Student"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--主键使用标签 id --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;id property="id" column="id"/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--property指Java Bean成员，column指对应数据库字段名--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"cls"</span> <span class="attr">column</span>=<span class="string">"class"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectAll"</span> <span class="attr">resultMap</span>=<span class="string">"studentResultMap"</span>&gt;</span></span><br><span class="line">        select * from students;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>其实就是配置一个<code>resultMap</code>，并将该<code>resultMap</code>放置到所需方法中即可。</p></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://why8n.top/post/2018/11/07/m3u8%E6%A0%BC%E5%BC%8F%E8%AF%A6%E8%A7%A3/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Whyn"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.gif"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Whyn"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a class="post-title-link" href="/post/2018/11/07/m3u8%E6%A0%BC%E5%BC%8F%E8%AF%A6%E8%A7%A3/" itemprop="url">m3u8格式详解</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-07T08:55:29+08:00">2018-11-07</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/other/" itemprop="url" rel="index"><span itemprop="name">other</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><blockquote><p><a href="https://zh.wikipedia.org/wiki/M3U#M3U8" target="_blank" rel="noopener">M3U8</a> 是 Unicode 版本的 <a href="https://zh.wikipedia.org/wiki/M3U" target="_blank" rel="noopener">M3U</a>，用 UTF-8 编码。”M3U” 和 “M3U8” 文件都是苹果公司使用的 <a href="https://zh.wikipedia.org/wiki/HTTP_Live_Streaming" target="_blank" rel="noopener">HTTP Live Streaming（HLS）</a> 协议格式的基础，这种协议格式可以在 iPhone 和 Macbook 等设备播放。</p></blockquote><div class="post-button text-center"><a class="btn" href="/post/2018/11/07/m3u8%E6%A0%BC%E5%BC%8F%E8%AF%A6%E8%A7%A3/#more" rel="contents">阅读全文 &raquo;</a></div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article></section><nav class="pagination"><a class="extend prev" rel="prev" href="/page/2/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span></nav></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><section class="site-overview-wrap sidebar-panel sidebar-panel-active"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">Whyn</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">8</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">2</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">8</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/why8n" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://www.jianshu.com/u/2baf4dc0fbe6" target="_blank" title="jianshu"><i class="fa fa-fw fa-custom jianshu"></i>jianshu</a> </span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/whyn-52" target="_blank" title="zhihu"><i class="fa fa-fw fa-custom zhihu"></i>zhihu</a> </span><span class="links-of-author-item"><a href="whyn@qq.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div><script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script><script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script><div class="widget-wrap"><h3 class="widget-title">bound tagcloudHelper</h3><div id="myCanvasContainer" class="widget tagcloud"><canvas width="250" height="250" id="resCanvas"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/hls/" rel="tag">hls</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/m3u8/" rel="tag">m3u8</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rg/" rel="tag">rg</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/" rel="tag">spring</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springboot/" rel="tag">springboot</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springmvc/" rel="tag">springmvc</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/" rel="tag">webpack</a><span class="tag-list-count">1</span></li></ul></canvas></div></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-history fa-" aria-hidden="true"></i> 近期文章</div><ul class="links-of-blogroll-list"><li><a href="/post/2020/02/09/webpack/" title="webpack" target="_blank">webpack</a></li><li><a href="/post/2020/02/09/SpringMVC/" title="SpringMVC" target="_blank">SpringMVC</a></li><li><a href="/post/2020/02/09/SpringBoot/" title="SpringBoot" target="_blank">SpringBoot</a></li><li><a href="/post/2020/02/09/Spring/" title="Spring" target="_blank">Spring</a></li><li><a href="/post/2020/02/09/rg%20-%20%E5%BD%93%E5%89%8D%E6%9C%80%E5%BF%AB%E7%9A%84%E6%96%87%E6%9C%AC%E6%90%9C%E7%B4%A2%E7%A5%9E%E5%99%A8/" title="rg - 当前最快的文本搜索神器" target="_blank">rg - 当前最快的文本搜索神器</a></li></ul></div><div class="site_total_count"><span class="post-count">博客全站共 <strong>63.1k</strong> 字</span></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">Whyn</span></div><div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div><span class="post-meta-divider">|</span><div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Pisces</a> v6.0.4</div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/js/src/utils.js?v=6.0.4"></script><script type="text/javascript" src="/js/src/motion.js?v=6.0.4"></script><script type="text/javascript" src="/js/src/affix.js?v=6.0.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.0.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.4"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){function r(e,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===t&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url),d=[],g=[];if(""!=l&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}d=d.concat(e(t,h,!1)),g=g.concat(e(t,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;0>w&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(t){b+="<a href='"+f+'\'><p class="search-result">'+s(p,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){var e=27===t.which&&$(".search-popup").is(":visible");e&&onPopupClose()})</script></body></html><!-- rebuild by neat -->